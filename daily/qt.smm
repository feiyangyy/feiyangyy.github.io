{"layout":"logicalStructure","root":{"data":{"text":"<p>QT</p>","expand":true,"uid":"493fe47e-447a-4141-b050-ccfe8989c419","richText":true,"isActive":false,"imgMap":{}},"children":[{"data":{"text":"<p>QT对象模型</p>","uid":"e047f6ea-4307-489b-ba4e-a96f6986b1bc","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>顶级父类QObject</p>","uid":"855bd10d-b8f1-4136-8bac-122925bc7da7","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>qobject_cast 有点像dynamic_cast, 可以安全的下行转换</p>","uid":"3c9e2bbc-a6f1-4dd2-aa48-a535ef9a381a","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>QT内存管理机制</p>","uid":"3f76e0ec-f1f4-4717-991e-0e7784d8553f","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>父子内存管理机制，父销毁-&gt;子销毁</p>","uid":"88ccb85e-96fa-4ce0-b7dc-94b999534625","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>所有权转移，setParent(xx)</p>","uid":"2c217de6-dd31-4cdf-bda2-3747f03a9996","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>QT很多类型采用了COW技术</p>","uid":"45309f76-c206-4c96-82c5-36944f376c48","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>QString</p>","uid":"72cf49ee-2599-4a83-a924-18730b82d56e","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>QImage</p>","uid":"a08ae8b6-26fc-4889-8dfc-eda103719ba6","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>...</p>","uid":"afc406fb-b96a-4ef1-8b0c-30c94712e3fe","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p><span style=\"color: rgb(244, 78, 59);\">moveToThread</span></p>","uid":"5ea4db94-7a5c-41cc-b479-16edce67d5a8","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>每个QObject 有所属线程</p>","uid":"95b1a547-c729-4f9b-bcf1-e3af7edb7abe","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>QObject 对应slot在所属线程中运行（所属线程的事件循环）</p>","uid":"db63edcd-8eaa-4039-ad9a-dbdd08fbdd29","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>关联qt信号槽机制的几种连接机制 Auto/Queued/Direct</p>","uid":"9e23dcc7-315e-464c-8680-0e90ceda02f7","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>会递归移动子对象</p>","uid":"0204206c-5966-4368-8d20-7c24a1c2c6f2","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><span style=\"color: rgb(254, 146, 0);\">有父对象且父对象所属线程和目标线程不匹配时，不能移动</span></p>","uid":"0bbaeb31-a01f-483b-b2e7-484dc2f2b8cb","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>deleteLater, 会在所属线程中删除</p>","uid":"3d93b22c-c068-4041-a850-c8ea40fb3f7f","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>图形资源管理</p>","uid":"9fc3a0de-7e19-4865-ba7d-e93e9e2498f5","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>非UI线程禁止访问（修改）</p>","uid":"72ce4e54-307b-4453-a6fe-71ec6e0d08a6","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>大部分支持COW</p>","uid":"7fa043ed-9deb-44d5-ad01-816fe77687f1","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>容器</p>","uid":"6128396a-5a63-4546-8b74-1e3f2bef7322","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>QVector/QList/QMap 等</p>","uid":"bcdb29d7-6525-4da8-9b25-5cd81e1644bb","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>一些接口和STL稍有不同</p>","uid":"635efe4d-0193-446f-b419-1d48196be780","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>QVector 等内存增长策略稍有不同</p>","uid":"e8ee02fe-d56d-43a5-861a-56dccaae8151","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>根本原因是诞生过早，各平台实现的容器行为可能不一致</p>","uid":"4ddde950-0ff4-44b8-a081-1e696f9c7969","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>现代QT可以由开发者决定采用何种容器，Qt容器不是必须</p>","uid":"f0b1e450-4279-42b1-89d4-9a8575e44495","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>信号槽机制</p>","uid":"2b874b16-d433-4927-a34d-4cb3dc4718cb","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>一般建议AutoConnect, 根据情况选择连接方式</p>","uid":"12410f9b-02e7-4dfa-8afa-e722ed734cfe","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>注意可能会有重复连接，重复连接会出发多次调用</p>","uid":"7de0a561-1656-4025-91b3-14a9cddd15bb","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>元对象系统</p>","uid":"196aca83-01d2-4c5e-9aea-1db1d601e17d","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>Q_OBJECT 宏</p>","uid":"70d70bd5-9aac-4ef3-a166-9ab2772bc1e2","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>Signal</p>","uid":"3a03f1a9-5995-4c2e-8437-d02e52fd9319","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>编译时，通过moc 生成额外代码，特别是生成信号槽相关代码</p>","uid":"06579095-13bc-4883-823b-80dbfe164e45","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>为对应的类提供staticMetaObject</p>","uid":"a9971874-2fe9-45b8-b5cb-399f2eba6b18","expand":true,"richText":true,"isActive":false,"generalization":[{"text":"<p>支撑qobject_cast</p>","range":[0,1],"uid":"1710a0b3-7e83-4d45-a881-3fa246bf921c","richText":true,"isActive":false,"expand":true}]},"children":[{"data":{"text":"<p>类名</p>","uid":"61df3525-003d-4b54-9f77-922f6259ae79","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>父类信息</p>","uid":"68035c0d-fbf9-4fe1-8a24-c179ca4c7793","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>方法信息（信号/slot/普通函数）</p>","uid":"e78bd821-1d6f-46f2-8fef-0a2834c418a6","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>其他..</p>","uid":"7c6eee67-2cb0-4032-ac50-53492415d6b5","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>实现signal slot的元信息</p>","uid":"44ee7640-9a8f-42a6-9ccf-dcfdb5a6f362","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>支持索引信号 indexOfSignal</p>","uid":"50b8c705-5ecf-4990-b0f9-af57c6c2fcb1","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>主要是为了支撑信号槽机制</p>","uid":"68188416-cfa0-4492-87ce-8c917ea9a31f","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>信号实现</p>","uid":"cd2af59f-3234-4323-9501-06ae1249cdf6","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>xxx activate</p>","uid":"16f19066-3966-417a-8609-74b2003d9724","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>支持反射编程</p>","uid":"ebf923a0-b0fc-4e3e-8d33-93a106fea4d5","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>获取类型名</p>","uid":"294cb624-3f76-4a6f-be67-b67096f9ce95","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>通过方法名调用等</p>","uid":"f1bb94b5-d48a-4d8b-8cc0-c4661e3c9c13","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>通过QMetaObject::invokeMethod 调用</p>","uid":"d46215e8-c13b-4523-9002-6a3a87f20b86","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>emit signal()</p>","uid":"b0e0231c-0232-429f-bc76-5aaa0b57e618","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>DirectConnect</p>","uid":"15b817c5-2634-4633-ae42-9c23a517c63d","expand":true,"richText":true,"isActive":false,"generalization":[{"text":"<p>就是调用语义</p>","range":[1,2],"uid":"522a31f8-4b4c-4199-8c71-a7b48db68df9","richText":true,"isActive":false,"expand":true}]},"children":[{"data":{"text":"<p>最终是直接调用槽函数</p>","uid":"bb4e6cd6-1675-44f7-9c1c-b0e5045c7b0d","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>基本类型参数</p>","uid":"62c8d2e4-f295-4b6c-8a9d-527674da328c","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>直接传递</p>","uid":"23049d0c-6ee0-4852-a1f2-8cdce3e15f7c","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>QString/QImage 值类型</p>","uid":"9211e7ab-71b8-481f-a12e-b928a9a2bcb0","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>浅拷贝</p>","uid":"f0faa518-2dac-4352-b345-5fbb01b87d93","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>COW的对象，引用计数+1</p>","uid":"3d7fed04-7947-4967-9a9c-f809ee476462","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>Queued</p>","uid":"9b64269b-afa4-461d-a5d4-002daf7f4eeb","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>加入接受者的线程的事件队列，最终会派发到对象上</p>","uid":"f298e3bb-678e-4602-a2c3-007dcb82d1d0","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>更底层是事件系统</p>","uid":"93716805-f5e7-4863-a632-4018b759f54c","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>所有参数要做深拷贝</p>","uid":"532acd96-65c1-422c-b876-7aab943d3a51","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>QString 等COW的对象需要拷贝一个新的，完全复制</p>","uid":"838529c3-8478-4fa7-8100-0c3ea713b341","expand":true,"richText":true,"isActive":false,"associativeLineTargets":["1084939f-5c07-4998-9cb2-a4c4d74c9436"],"associativeLineTargetControlOffsets":[[{"x":71,"y":0},{"x":76,"y":0}]],"associativeLinePoint":[{"startPoint":{"x":2112,"y":1102,"dir":"left"},"endPoint":{"x":2107,"y":1244,"dir":"top"}}],"associativeLineStyle":{"1084939f-5c07-4998-9cb2-a4c4d74c9436":{"associativeLineColor":"rgb(51, 51, 51)","associativeLineWidth":2,"associativeLineActiveWidth":8,"associativeLineDasharray":"6,4","associativeLineActiveColor":"#F44E3B","associativeLineTextFontSize":14,"associativeLineTextColor":"rgb(51, 51, 51)","associativeLineTextFontFamily":"微软雅黑, Microsoft YaHei"}}},"children":[]},{"data":{"text":"<p>指针类参数，要确保调用slot时，指针仍然有效</p>","uid":"903aad2b-a355-4bee-b69e-fb9c8e992ac1","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>自定义类型作为参数</p>","uid":"719e6691-7c39-483c-aead-470aa773fe46","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>要注册到类型系统中</p>","uid":"4ec3c30a-aea0-4f6f-a507-b47dcf86dec9","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><span style=\"color: rgb(244, 78, 59);\">大对象要考虑传参拷贝引起的性能问题</span></p>","uid":"1084939f-5c07-4998-9cb2-a4c4d74c9436","expand":true,"richText":true,"isActive":false},"children":[]}]}]}]},{"data":{"text":"<p>slot</p>","uid":"7b1b9688-0a79-46a6-a955-8b7840a48c56","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>就是普通函数，可以是lambda</p>","uid":"10b10965-ea39-4f0e-aa1b-1cece9cecb56","expand":true,"richText":true,"isActive":false},"children":[]}]}]}]},{"data":{"text":"<p>GUI</p>","uid":"9102b405-868e-45ea-8af2-e82027f7a9af","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>QMainWindow/QWidget/QPushButton 等常规UI组件</p>","uid":"9edcbed8-196c-491a-a85b-c7bf92f29982","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>QSS样式表</p>","uid":"1e2a76ff-3821-43e1-9329-80b1c0054e1f","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><span style=\"color: rgb(211, 49, 21);\">MVC机制</span></p>","uid":"ddc61966-4b78-4bed-b1fc-3f308011796d","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>Model</p>","uid":"3b7c765a-a59c-4ca3-bae4-79251978150a","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>存储和管理数据</p>","uid":"f3b969c2-5231-4a18-ba3a-22c53cfe1379","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>View</p>","uid":"3c66373e-c365-40ec-8766-10f7ce69d6c8","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>显示数据</p>","uid":"d79e13cd-1d41-4751-9bed-ffb94623c69b","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>Controll</p>","uid":"2dc1ea50-8a58-445f-ae81-43f2f0631a60","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>通常是View中的事件机制和业务代码决定，协调Model/View</p>","uid":"66c3bc89-f4fc-44c6-902c-2125078a9a72","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>不像Web中的MVC框架那么明确，融合View和Model显示的业务逻辑，或者响应行为等，就是Controller角色</p>","uid":"07dae1c8-9918-455d-bacc-5df5dacaaf35","expand":true,"richText":true,"isActive":false},"children":[]}]}]}]},{"data":{"text":"<p><span style=\"background-color: rgb(244, 78, 59);\">事件系统</span></p>","uid":"8b078025-c538-47aa-b19e-502152ca2b65","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>基于QEvent和时间循环</p>","uid":"dcb0c727-211b-4ca3-ab36-5a862d41dfc9","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>封装了OS的事件，如鼠标、键盘事件</p>","uid":"218c301e-85ab-4fdf-a9f8-732c17731b7b","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>事件</p>","uid":"b420dbc1-847f-4ef2-b69a-3459bbfa69dc","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>所有事件继承自QEvent</p>","uid":"6b82957f-4c28-4ab9-82fa-b020c4e29dc0","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>常见的Event</p>","uid":"5f531408-82a2-4a13-8c6c-7874056530eb","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>QMouseEvent</p>","uid":"5b344896-d9c6-4932-a903-7cd8f02cc749","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>QKeyEvent</p>","uid":"f54371be-3fbc-4d31-bc60-d6032990fb60","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>QPaintEvent</p>","uid":"bcc258ac-65d2-48bd-af8f-c273e4d91097","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>管理者:QEventDispatcher</p>","uid":"63b966ca-eda3-4324-be68-6f4bee931676","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>拿到Event后会发送到目标QObject</p>","uid":"200d6b0b-54c0-4d5e-8d09-6a442ea0aa53","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>处理</p>","uid":"008e3c3c-5058-4a89-b832-78aacc0c2d68","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>event虚函数</p>","uid":"ae72f38f-5ebe-433a-96ce-1c229e056757","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>qobject或者QWidget的event虚函数</p>","uid":"f871d189-94f7-4c80-9163-a318809f3bc4","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>event中判断事件类型处理</p>","uid":"1ef091f9-1241-4990-baf6-3fabf673a7eb","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>installEventFilter</p>","uid":"365e7916-3af6-43f5-8df0-b9d461a6a26f","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>事件过滤函数处理事件</p>","uid":"481452f9-6826-4a6b-abc0-b16b704dfd54","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>相当于hook另外一个对象的所有事件，在事件到达被hook对象之前做处理</p>","uid":"d37a1bb6-90f8-428e-8707-826ec66bc5f9","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>自定义EventFilter, 并重写eventFilter 方法，在install到目标对象上即可</p>","uid":"eafcfded-d724-411d-ae2c-437cf7947e7e","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>典型场景：捕捉QMainWindow的全局键盘事件，实现一些组合建功能等</p>","uid":"3cb1b367-40db-482e-b9ff-9bde0c2cf4b7","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>分发</p>","uid":"e693ffe1-4622-452d-a8d7-506801ba089a","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>postEvent 往特定对象分发事件</p>","uid":"c6fee314-3f00-4d2a-b832-9d5311113824","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>自定义事件，通过继承QEvent 即可</p>","uid":"2823e54c-9ee6-4055-bc0b-2a96b9e466fb","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>事件循环</p>","uid":"1ec98e06-7579-4a57-935e-e1c3fa95b3c7","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>注意事件循环的嵌套，比如QDialog::exec 会启动自己的事件循环从而阻塞main window的循环</p>","uid":"e5a0935b-1bf2-4a68-8b9e-fe863c2b59fe","expand":true,"richText":true,"isActive":false},"children":[]}]}]}],"smmVersion":"0.14.0-fix.1"},"theme":{"template":"classic4","config":{}},"view":{"transform":{"scaleX":1,"scaleY":1,"shear":0,"rotate":0,"translateX":-576,"translateY":-885,"originX":0,"originY":0,"a":1,"b":0,"c":0,"d":1,"e":-576,"f":-885},"state":{"scale":1,"x":-576,"y":-885,"sx":-576,"sy":-685}}}